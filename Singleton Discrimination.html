<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="jspsych/jspsych.js"></script>
    <script src='JSPsych/plugins/jspsych-html-keyboard-response.js'></script>
    <script src='JSPsych/plugins/jspsych-fullscreen.js'></script>
    <script src="jspsych/plugins/jspsych-categorize-html.js"></script>
    <link rel="stylesheet" href="jspsych/css/jspsych.css">
</head>

<body></body>
<script>
    var subjectID = jsPsych.randomization.randomID(15);
    var conditionColor = jsPsych.randomization.sampleWithoutReplacement(['Red', 'Green'], 1)[0];
    jsPsych.data.addProperties({
        subject: subjectID,
        condition: conditionColor,
    })

    ////////////////////////////////////////////////////////////////////VDAC Task////////////////////////////////////////////////////////////////////

    var rewardTotal = Math.round(0)
    var counterbalanceCondition = Math.random()
    var fixationStim = '<svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet"> <path d="M 50 52 L 50 48" stroke="black" stroke-width=".5"/> <path d="M 52 50 L 48 50" stroke="black" stroke-width=".5"/>'
    var trainingArray = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,]
    var greenHighReward = [
        //Red Horizontal
        { stimulus: singletonStim(0, 'red', 'h'), data: { color: 'red', rewardType: 'low', orientation: 'horizontal' } },
        { stimulus: singletonStim(0, 'red', 'h'), data: { color: 'red', rewardType: 'low', orientation: 'horizontal' } },
        { stimulus: singletonStim(0, 'red', 'h'), data: { color: 'red', rewardType: 'low', orientation: 'horizontal' } },
        { stimulus: singletonStim(0, 'red', 'h'), data: { color: 'red', rewardType: 'low', orientation: 'horizontal' } },
        { stimulus: singletonStim(0, 'red', 'h'), data: { color: 'red', rewardType: 'low', orientation: 'horizontal' } },
        { stimulus: singletonStim(0, 'red', 'h'), data: { color: 'red', rewardType: 'low', orientation: 'horizontal' } },
        //Red Vertical
        { stimulus: singletonStim(0, 'red', 'v'), data: { color: 'red', rewardType: 'low', orientation: 'vertical' } },
        { stimulus: singletonStim(1, 'red', 'v'), data: { color: 'red', rewardType: 'low', orientation: 'vertical' } },
        { stimulus: singletonStim(2, 'red', 'v'), data: { color: 'red', rewardType: 'low', orientation: 'vertical' } },
        { stimulus: singletonStim(3, 'red', 'v'), data: { color: 'red', rewardType: 'low', orientation: 'vertical' } },
        { stimulus: singletonStim(4, 'red', 'v'), data: { color: 'red', rewardType: 'low', orientation: 'vertical' } },
        { stimulus: singletonStim(5, 'red', 'v'), data: { color: 'red', rewardType: 'low', orientation: 'vertical' } },
        //Green Vertical
        { stimulus: singletonStim(0, 'green', 'h'), data: { color: 'green', rewardType: 'high', orientation: 'horizontal' } },
        { stimulus: singletonStim(1, 'green', 'h'), data: { color: 'green', rewardType: 'high', orientation: 'horizontal' } },
        { stimulus: singletonStim(2, 'green', 'h'), data: { color: 'green', rewardType: 'high', orientation: 'horizontal' } },
        { stimulus: singletonStim(3, 'green', 'h'), data: { color: 'green', rewardType: 'high', orientation: 'horizontal' } },
        { stimulus: singletonStim(4, 'green', 'h'), data: { color: 'green', rewardType: 'high', orientation: 'horizontal' } },
        { stimulus: singletonStim(5, 'green', 'h'), data: { color: 'green', rewardType: 'high', orientation: 'horizontal' } },
        //Green Horizontal
        { stimulus: singletonStim(0, 'green', 'v'), data: { color: 'green', rewardType: 'high', orientation: 'vertical' } },
        { stimulus: singletonStim(1, 'green', 'v'), data: { color: 'green', rewardType: 'high', orientation: 'vertical' } },
        { stimulus: singletonStim(2, 'green', 'v'), data: { color: 'green', rewardType: 'high', orientation: 'vertical' } },
        { stimulus: singletonStim(3, 'green', 'v'), data: { color: 'green', rewardType: 'high', orientation: 'vertical' } },
        { stimulus: singletonStim(4, 'green', 'v'), data: { color: 'green', rewardType: 'high', orientation: 'vertical' } },
        { stimulus: singletonStim(5, 'green', 'v'), data: { color: 'green', rewardType: 'high', orientation: 'vertical' } },
    ]
    var redHighReward = [
        //Red Horizontal
        { stimulus: singletonStim(0, 'red', 'h'), data: { color: 'red', rewardType: 'high', orientation: 'horizontal' } },
        { stimulus: singletonStim(0, 'red', 'h'), data: { color: 'red', rewardType: 'high', orientation: 'horizontal' } },
        { stimulus: singletonStim(2, 'red', 'h'), data: { color: 'red', rewardType: 'high', orientation: 'horizontal' } },
        { stimulus: singletonStim(3, 'red', 'h'), data: { color: 'red', rewardType: 'high', orientation: 'horizontal' } },
        { stimulus: singletonStim(4, 'red', 'h'), data: { color: 'red', rewardType: 'high', orientation: 'horizontal' } },
        { stimulus: singletonStim(5, 'red', 'h'), data: { color: 'red', rewardType: 'high', orientation: 'horizontal' } },
        //Red Vertical
        { stimulus: singletonStim(0, 'red', 'v'), data: { color: 'red', rewardType: 'high', orientation: 'vertical' } },
        { stimulus: singletonStim(1, 'red', 'v'), data: { color: 'red', rewardType: 'high', orientation: 'vertical' } },
        { stimulus: singletonStim(2, 'red', 'v'), data: { color: 'red', rewardType: 'high', orientation: 'vertical' } },
        { stimulus: singletonStim(3, 'red', 'v'), data: { color: 'red', rewardType: 'high', orientation: 'vertical' } },
        { stimulus: singletonStim(4, 'red', 'v'), data: { color: 'red', rewardType: 'high', orientation: 'vertical' } },
        { stimulus: singletonStim(5, 'red', 'v'), data: { color: 'red', rewardType: 'high', orientation: 'vertical' } },
        //Green Vertical
        { stimulus: singletonStim(0, 'green', 'h'), data: { color: 'green', rewardType: 'low', orientation: 'horizontal' } },
        { stimulus: singletonStim(1, 'green', 'h'), data: { color: 'green', rewardType: 'low', orientation: 'horizontal' } },
        { stimulus: singletonStim(2, 'green', 'h'), data: { color: 'green', rewardType: 'low', orientation: 'horizontal' } },
        { stimulus: singletonStim(3, 'green', 'h'), data: { color: 'green', rewardType: 'low', orientation: 'horizontal' } },
        { stimulus: singletonStim(4, 'green', 'h'), data: { color: 'green', rewardType: 'low', orientation: 'horizontal' } },
        { stimulus: singletonStim(5, 'green', 'h'), data: { color: 'green', rewardType: 'low', orientation: 'horizontal' } },
        //Green Horizontal
        { stimulus: singletonStim(0, 'green', 'v'), data: { color: 'green', rewardType: 'low', orientation: 'vertical' } },
        { stimulus: singletonStim(1, 'green', 'v'), data: { color: 'green', rewardType: 'low', orientation: 'vertical' } },
        { stimulus: singletonStim(2, 'green', 'v'), data: { color: 'green', rewardType: 'low', orientation: 'vertical' } },
        { stimulus: singletonStim(3, 'green', 'v'), data: { color: 'green', rewardType: 'low', orientation: 'vertical' } },
        { stimulus: singletonStim(4, 'green', 'v'), data: { color: 'green', rewardType: 'low', orientation: 'vertical' } },
        { stimulus: singletonStim(5, 'green', 'v'), data: { color: 'green', rewardType: 'low', orientation: 'vertical' } },
    ]
    function singletonStim(tgtPosition, tgtColor, tgtOrientation) {
        var svg = '<svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">'
        var colors = jsPsych.randomization.repeat(['cyan', 'blueviolet', 'black', 'orangered', 'gold'], 1)
        colors.splice(tgtPosition, 0, tgtColor)
        svg += '<circle cx="50" cy="50" r="10" fill="none" transform="translate( 26  15)" stroke="' + colors[0] + '" />'
        svg += '<circle cx="50" cy="50" r="10" fill="none" transform="translate(  0  30)" stroke="' + colors[1] + '" />'
        svg += '<circle cx="50" cy="50" r="10" fill="none" transform="translate(-26  15)" stroke="' + colors[2] + '" />'
        svg += '<circle cx="50" cy="50" r="10" fill="none" transform="translate(-26 -15)" stroke="' + colors[3] + '" />'
        svg += '<circle cx="50" cy="50" r="10" fill="none" transform="translate(  0 -30)" stroke="' + colors[4] + '" />'
        svg += '<circle cx="50" cy="50" r="10" fill="none" transform="translate( 26 -15)" stroke="' + colors[5] + '" />'
        var angle = []
        for (i = 0; i < 5; i++) {
            if (Math.random() < 0.5) {
                angle[i] = '45'
            } else {
                angle[i] = '-45'
            }
        }
        if (tgtOrientation == 'h') {
            angle.splice(tgtPosition, 0, '90')
        } else if (tgtOrientation == 'v') {
            angle.splice(tgtPosition, 0, '0')
        }
        svg += '<path d="M 50 57 L 50 43" stroke="black" transform="translate( 26  15) rotate(' + angle[0] + ' 50 50)"/>'
        svg += '<path d="M 50 57 L 50 43" stroke="black" transform="translate(  0  30) rotate(' + angle[1] + ' 50 50)"/>'
        svg += '<path d="M 50 57 L 50 43" stroke="black" transform="translate(-26  15) rotate(' + angle[2] + ' 50 50)"/>'
        svg += '<path d="M 50 57 L 50 43" stroke="black" transform="translate(-26 -15) rotate(' + angle[3] + ' 50 50)"/>'
        svg += '<path d="M 50 57 L 50 43" stroke="black" transform="translate(  0 -30) rotate(' + angle[4] + ' 50 50)"/>'
        svg += '<path d="M 50 57 L 50 43" stroke="black" transform="translate( 26 -15) rotate(' + angle[5] + ' 50 50)"/>'
        svg += '<path d="M 50 52 L 50 48" stroke="black" stroke-width=".5"/> <path d="M 52 50 L 48 50" stroke="black" stroke-width=".5"/>'
        svg += '</svg>'
        return svg
    }
    var instructionsGap = {
        type: "html-keyboard-response",
        stimulus: "<p>You have completed the training activity. You will now begin the experiment</p>" +
            "<p>Press any key to begin.</p>",
        on_finish: function () {
            trainingArray = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0,]
        },
        post_trial_gap: 1000
    }
    var VDACinstructions = {
        timeline: [
            {
                type: 'fullscreen',
                fullscreen_mode: true,
            },
            {
                type: "html-keyboard-response",
                stimulus: "<p>In this task, you will see six circles with a line inside of them.</p>" +
                    "<p>One line will be positioned horizontally or vertically. All other lines will be positioned diagonally.</p>" +
                    "<p>Press the 'h' key if that line is positioned horizontally, or press the 'v' key if the line is positioned vertically.</p>" +
                    "<p>Press any key to begin.</p>",
                post_trial_gap: 1000
            }
        ]
    }
    var VDACtraining = {
        timeline: [
            {
                type: 'html-keyboard-response',
                stimulus: fixationStim,
                choices: jsPsych.NO_KEYS,
                trial_duration: Math.floor(Math.random() * 600) + 400,
            },
            {
                type: 'html-keyboard-response',
                choices: [86, 72],
                prompt: '<p>(V)ertical or (H)orizontal</p>',
                trial_duration: 2000,
                stimulus: jsPsych.timelineVariable('stimulus'),
                data: jsPsych.timelineVariable('data'),
                on_finish: function (data) {
                    var correct = null;
                    if (data.orientation == 'horizontal' && data.key_press == 72) {
                        correct = true
                    } else if (data.orientation == 'vertical' && data.key_press == 86) {
                        correct = true;
                    } else if (data.orientation == 'horizontal' && data.key_press == 86) {
                        correct = false;
                    } else if (data.orientation == 'vertical' && data.key_press == 72) {
                        correct = false;
                    }
                    data.correct = correct;
                },
                post_trial_gap: 1000,
            },
            {
                type: 'html-keyboard-response',
                stimulus: function () {
                    if (jsPsych.data.getLastTrialData().values()[0].correct == true) {
                        trainingArray.push(1)
                        trainingArray.shift()
                        return '<span style="font-size:30px;color:black;">Correct!</span>'
                    } else if (jsPsych.data.getLastTrialData().values()[0].correct == false) {
                        trainingArray.push(0)
                        trainingArray.shift()
                        return '<span style="font-size:30px;color:black;">Incorrect Response</span> <p></p> <span style="font-size:30px;color:black;">Try Again</span>'
                    } else if (jsPsych.data.getLastTrialData().values()[0].correct == null) {
                        trainingArray.push(0)
                        trainingArray.shift()
                        return '<span style="font-size:30px;color:black;">Too Slow</span> <p></p> <span style="font-size:30px;color:black;">Try Again</span>'
                    }
                },
                choices: jsPsych.NO_KEYS,
                trial_duration: 1500,
                post_trial_gap: 1000,
            }
        ],
        timeline_variables: redHighReward,
        sample: {
            type: 'without-replacement',
            size: 1,
        },
        repetitions: 1,
        loop_function: function () {
            console.log(trainingArray)
            if (trainingArray.reduce((a, b) => a + b, 0) >= 7) {
                return false
            } else {
                return true
            }
        },
    }
    var VDACtask = {
        timeline: [
            {
                type: 'html-keyboard-response',
                stimulus: fixationStim,
                choices: jsPsych.NO_KEYS,
                trial_duration: Math.floor(Math.random() * 600) + 400,
            },
            {
                type: 'html-keyboard-response',
                choices: [86, 72],
                trial_duration: 600, //Change value to speed up of slow down test
                stimulus: jsPsych.timelineVariable('stimulus'),
                data: jsPsych.timelineVariable('data'),
                on_finish: function (data) {
                    var correct = null
                    if (data.orientation == 'horizontal' && data.key_press == 72) {
                        correct = true
                    } else if (data.orientation == 'vertical' && data.key_press == 86) {
                        correct = true
                    } else if (data.orientation == 'horizontal' && data.key_press == 86) {
                        correct = false
                    } else if (data.orientation == 'vertical' && data.key_press == 72) {
                        correct = false
                    }
                    data.correct = correct
                },
                post_trial_gap: 1000,
            },
            {
                type: 'html-keyboard-response',
                stimulus: function (data) {
                    var rewardTrial = 0.05
                    if (jsPsych.data.getLastTrialData().values()[0].correct == true && jsPsych.data.getLastTrialData().values()[0].rewardType == 'low') {
                        if (Math.random() < .2) {
                            rewardTrial = 0.1
                        }
                        rewardTotal = rewardTotal + rewardTrial
                        return '<span style="font-size:30px;color:black;"> + ' + rewardTrial + '</span> <p></p> <span style="font-size:30px;color:black;"> Total $' + rewardTotal.toFixed(2)
                    } else if (jsPsych.data.getLastTrialData().values()[0].correct == true && jsPsych.data.getLastTrialData().values()[0].rewardType == 'high') {
                        if (Math.random() < .8) {
                            rewardTrial = 0.1
                        }
                        rewardTotal = rewardTotal + rewardTrial
                        return '<span style="font-size:30px;color:black;"> + ' + rewardTrial + '</span> <p></p> <span style="font-size:30px;color:black;"> Total $' + rewardTotal.toFixed(2)
                    } else {
                        return '<span style="font-size:30px;">****</span>'
                    }
                },
                on_finish: function(data) {
                    data.reward = rewardTotal
                },
                choices: jsPsych.NO_KEYS,
                trial_duration: 1500,
                post_trial_gap: 1000,
            }
        ]
    }
    var trialSize = 5 // change number of test trials here
    var VDACgreen = {
        timeline: [VDACtask],
        conditional_function: function () {
            if (conditionColor == 'Green') {
                return true
            } else {
                return false
            }
        },
        timeline_variables: greenHighReward,
        sample: {
            type: 'without-replacement',
            size: trialSize,
        },
        repetitions: 1,
        randomize_order: true
    }
    var VDACred = {
        timeline: [VDACtask],
        conditional_function: function () {
            if (conditionColor == 'Red') {
                return true
            } else {
                return false
            }
        },
        timeline_variables: redHighReward,
        sample: {
            type: 'without-replacement',
            size: trialSize,
        },
        repetitions: 1,
        randomize_order: true
    }

    ////////////////////////////////////////////////////////////////////RSVP Task////////////////////////////////////////////////////////////////////

    var alphabet = ["a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"];
    var speedRSVP = 500 //speed up or slow down RSVP here
    var letterStim = []
    var letterTgt = []
    function generateStimuli(tgtPosition, tgtColor) {
        var letters = jsPsych.randomization.sampleWithoutReplacement(alphabet, 4)
        for (i = 0; i <= 3; i++) {
            if (i == tgtPosition) {
                letterStim[i] = '<svg viewBox="0 0 100 100""><text fill="' + tgtColor + '" font-size="5" font-family="sans-serif" x="49" y="51">' + letters[i] + '</text>'
            } else {
                letterStim[i] = '<svg viewBox="0 0 100 100""><text fill="black" font-size="5" font-family="sans-serif" x="49" y="51">' + letters[i] + '</text>'
            }
            letterTgt[i] = '<svg viewBox="0 0 100 100""><text fill="black" font-size="5" font-family="sans-serif" x="49" y="51">' + letters[i] + '</text>'
        }
    }
    var RSVPinstructions = {
        timeline: [
            {
                type: "html-keyboard-response",
                stimulus: "<p>In this task, you will see a series of three different letters presented rapidly.</p>" +
                    "<p>After a brief pause, you will be shown either a new letter or a letter than was presented in the set</p>" +
                    "<p>Press the 's' key if that letter has been shown, or press the 'd' key if that letter is new.</p>" +
                    "<p>Press any key to begin.</p>",

                post_trial_gap: 1000
            }
        ]
    }
    var RSVPStim = [ //'n' indicates "different" for the target in tgtPosition, 'n' indicates 'no color' in colorPosition
        { stimulus: generateStimuli(null, 'green'), tgt: letterTgt[0], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '1', color: 'green', colorPosition: 'n' } },
        { stimulus: generateStimuli(null, 'green'), tgt: letterTgt[1], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '2', color: 'green', colorPosition: 'n' } },
        { stimulus: generateStimuli(null, 'green'), tgt: letterTgt[2], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '3', color: 'green', colorPosition: 'n' } },
        { stimulus: generateStimuli(null, 'green'), tgt: letterTgt[3], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: 'n', color: 'green', colorPosition: 'n' } },

        { stimulus: generateStimuli(0, 'green'), tgt: letterTgt[0], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '1', color: 'green', colorPosition: '1' } },
        { stimulus: generateStimuli(0, 'green'), tgt: letterTgt[1], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '2', color: 'green', colorPosition: '1' } },
        { stimulus: generateStimuli(0, 'green'), tgt: letterTgt[2], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '3', color: 'green', colorPosition: '1' } },
        { stimulus: generateStimuli(0, 'green'), tgt: letterTgt[3], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: 'n', color: 'green', colorPosition: '1' } },

        { stimulus: generateStimuli(1, 'green'), tgt: letterTgt[0], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '1', color: 'green', colorPosition: '2' } },
        { stimulus: generateStimuli(1, 'green'), tgt: letterTgt[1], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '2', color: 'green', colorPosition: '2' } },
        { stimulus: generateStimuli(1, 'green'), tgt: letterTgt[2], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '3', color: 'green', colorPosition: '2' } },
        { stimulus: generateStimuli(1, 'green'), tgt: letterTgt[3], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: 'n', color: 'green', colorPosition: '2' } },

        { stimulus: generateStimuli(2, 'green'), tgt: letterTgt[0], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '1', color: 'green', colorPosition: '3' } },
        { stimulus: generateStimuli(2, 'green'), tgt: letterTgt[1], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '2', color: 'green', colorPosition: '3' } },
        { stimulus: generateStimuli(2, 'green'), tgt: letterTgt[2], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '3', color: 'green', colorPosition: '3' } },
        { stimulus: generateStimuli(2, 'green'), tgt: letterTgt[3], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: 'n', color: 'green', colorPosition: '3' } },

        { stimulus: generateStimuli(null, 'red'), tgt: letterTgt[0], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '1', color: 'red', colorPosition: 'n' } },
        { stimulus: generateStimuli(null, 'red'), tgt: letterTgt[1], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '2', color: 'red', colorPosition: 'n' } },
        { stimulus: generateStimuli(null, 'red'), tgt: letterTgt[2], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '3', color: 'red', colorPosition: 'n' } },
        { stimulus: generateStimuli(null, 'red'), tgt: letterTgt[3], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: 'n', color: 'red', colorPosition: 'n' } },

        { stimulus: generateStimuli(0, 'red'), tgt: letterTgt[0], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '1', color: 'red', colorPosition: '1' } },
        { stimulus: generateStimuli(0, 'red'), tgt: letterTgt[1], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '2', color: 'red', colorPosition: '1' } },
        { stimulus: generateStimuli(0, 'red'), tgt: letterTgt[2], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '3', color: 'red', colorPosition: '1' } },
        { stimulus: generateStimuli(0, 'red'), tgt: letterTgt[3], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: 'n', color: 'red', colorPosition: '1' } },

        { stimulus: generateStimuli(1, 'red'), tgt: letterTgt[0], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '1', color: 'red', colorPosition: '2' } },
        { stimulus: generateStimuli(1, 'red'), tgt: letterTgt[1], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '2', color: 'red', colorPosition: '2' } },
        { stimulus: generateStimuli(1, 'red'), tgt: letterTgt[2], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '3', color: 'red', colorPosition: '2' } },
        { stimulus: generateStimuli(1, 'red'), tgt: letterTgt[3], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: 'n', color: 'red', colorPosition: '2' } },

        { stimulus: generateStimuli(2, 'red'), tgt: letterTgt[0], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '1', color: 'red', colorPosition: '3' } },
        { stimulus: generateStimuli(2, 'red'), tgt: letterTgt[1], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '2', color: 'red', colorPosition: '3' } },
        { stimulus: generateStimuli(2, 'red'), tgt: letterTgt[2], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '3', color: 'red', colorPosition: '3' } },
        { stimulus: generateStimuli(2, 'red'), tgt: letterTgt[3], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: 'n', color: 'red', colorPosition: '3' } },
    ]
    var RSVPtraining = {
        timeline: [
            {
                type: 'html-keyboard-response',
                stimulus: fixationStim,
                choices: jsPsych.NO_KEYS,
                trial_duration: Math.floor(Math.random() * 600) + 400,
            },
            {
                type: 'html-keyboard-response',
                stimulus: jsPsych.timelineVariable('t1'),
                choices: jsPsych.NO_KEYS,
                trial_duration: speedRSVP,
            },
            {
                type: 'html-keyboard-response',
                stimulus: jsPsych.timelineVariable('t2'),
                choices: jsPsych.NO_KEYS,
                trial_duration: speedRSVP,
            },
            {
                type: 'html-keyboard-response',
                stimulus: jsPsych.timelineVariable('t3'),
                choices: jsPsych.NO_KEYS,
                trial_duration: speedRSVP,
            },
            {
                type: 'html-keyboard-response',
                stimulus: fixationStim,
                choices: jsPsych.NO_KEYS,
                trial_duration: 500,
            },
            {
                type: 'html-keyboard-response',
                stimulus: jsPsych.timelineVariable('tgt'),
                choices: [68, 83],
                prompt: '<p>(S)ame or (D)Different</p>',
                trial_duration: 5000,
                data: jsPsych.timelineVariable('data'),
                on_finish: function (data) {
                    var correct = null;
                    if (data.tgtPosition == 'n' && data.key_press == 68) {
                        correct = true
                    } else if (data.tgtPosition !== 'n' && data.key_press == 83) {
                        correct = true
                    } else {
                        correct = false
                    }
                    data.correct = correct
                }
            },
            {
                type: 'html-keyboard-response',
                stimulus: function () {
                    if (jsPsych.data.getLastTrialData().values()[0].correct == true) {
                        trainingArray.push(1)
                        trainingArray.shift()
                        return '<span style="font-size:30px;color:black;">Correct!</span>'
                    } else if (jsPsych.data.getLastTrialData().values()[0].correct == false) {
                        trainingArray.push(0)
                        trainingArray.shift()
                        return '<span style="font-size:30px;color:black;">Incorrect Response</span> <p></p> <span style="font-size:30px;color:black;">Try Again</span>'
                    } else if (jsPsych.data.getLastTrialData().values()[0].correct == null) {
                        trainingArray.push(0)
                        trainingArray.shift()
                        return '<span style="font-size:30px;color:black;">Too Slow</span> <p></p> <span style="font-size:30px;color:black;">Try Again</span>'
                    }
                },
                choices: jsPsych.NO_KEYS,
                trial_duration: 1500,
                post_trial_gap: 1000,
            }
        ],
        timeline_variables: [
            { stimulus: generateStimuli(null, 'red'), tgt: letterTgt[0], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '1' } },
            { stimulus: generateStimuli(null, 'red'), tgt: letterTgt[1], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '2' } },
            { stimulus: generateStimuli(null, 'red'), tgt: letterTgt[2], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: '3' } },
            { stimulus: generateStimuli(null, 'red'), tgt: letterTgt[3], t1: letterStim[0], t2: letterStim[1], t3: letterStim[2], data: { tgtPosition: 'n' } },
        ],
        sample: {
            type: 'without-replacement',
            size: 1,
        },
        repetitions: 1,
        loop_function: function () {
            console.log(trainingArray)
            if (trainingArray.reduce((a, b) => a + b, 0) >= 7) {
                return false
            } else {
                return true
            }
        },
    }
    var RSVPtask = {
        timeline: [
            {
                type: 'html-keyboard-response',
                stimulus: fixationStim,
                choices: jsPsych.NO_KEYS,
                trial_duration: Math.floor(Math.random() * 600) + 400,
            },
            {
                type: 'html-keyboard-response',
                stimulus: jsPsych.timelineVariable('t1'),
                choices: jsPsych.NO_KEYS,
                trial_duration: speedRSVP,
            },
            {
                type: 'html-keyboard-response',
                stimulus: jsPsych.timelineVariable('t2'),
                choices: jsPsych.NO_KEYS,
                trial_duration: speedRSVP,
            },
            {
                type: 'html-keyboard-response',
                stimulus: jsPsych.timelineVariable('t3'),
                choices: jsPsych.NO_KEYS,
                trial_duration: speedRSVP,
            },
            {
                type: 'html-keyboard-response',
                stimulus: fixationStim,
                choices: jsPsych.NO_KEYS,
                trial_duration: 500,
            },
            {
                type: 'html-keyboard-response',
                stimulus: jsPsych.timelineVariable('tgt'),
                choices: [68, 83],
                trial_duration: 5000,
                data: jsPsych.timelineVariable('data'),
                on_finish: function (data) {
                    var correct = null;
                    if (data.tgtPosition == 'n' && data.key_press == 68) {
                        correct = true
                    } else if (data.tgtPosition !== 'n' && data.key_press == 83) {
                        correct = true
                    } else {
                        correct = false
                    }
                    data.correct = correct
                }
            },
            {
                type: 'html-keyboard-response',
                stimulus: function () {
                    if (jsPsych.data.getLastTrialData().values()[0].correct == true) {
                        return '<span style="font-size:30px;color:black;">Correct!</span>'
                    } else if (jsPsych.data.getLastTrialData().values()[0].correct == false) {
                        return '<span style="font-size:30px;color:black;">Incorrect</span> <p></p> <span style="font-size:30px;color:black;">Try Again</span>'
                    } else if (jsPsych.data.getLastTrialData().values()[0].correct == null) {
                        return '<span style="font-size:30px;color:black;">Too Slow</span> <p></p> <span style="font-size:30px;color:black;">Try Again</span>'
                    }
                },
                choices: jsPsych.NO_KEYS,
                trial_duration: 1500,
                post_trial_gap: 1000,
            }
        ],
        timeline_variables: RSVPStim,
        sample: {
            type: 'without-replacement',
            size: 5, //Change number of test trials here, remove for full RSVPStim set
        },
        randomize_order: true

    }

    jsPsych.init({
        //List of timeline elements: VDACinstructions, VDACtraining, instructionsGap, VDACgreen, VDACred, RSVPinstructions, RSVPtraining, instructionsGap, RSVPtask
        //individual elements can be place for testing, consecutive training elements must have instructionsGap inbetween
        timeline: [VDACinstructions, VDACtraining, instructionsGap, VDACgreen, VDACred, RSVPinstructions, RSVPtraining, instructionsGap, RSVPtask],
        experiment_width: window.innerHeight - 7,
        on_finish: function () {
            jsPsych.data.displayData()
            jsPsych.data.get().localSave('csv', 'mydata.csv') //remove to stop downloading data file
        }
    })
</script>

</html>